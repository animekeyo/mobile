<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="/mobile-manifest.json?clear-2553">
    <link rel="icon" href="/icon-192x192.png">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('service worker registered'))
                .catch(err => console.log('service worker not registered', err));
        }
    </script>
    <title>Anime Keyo</title>
    <script src="https://canary.animekeyo.com/scripts/jquery.js"></script>
    <!---//////////////////////////------jquery------///////////////////////////--->

    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-messaging.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.7/dist/sweetalert2.all.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <script src="https://canary.animekeyo.com/scripts/firebase.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
        var SUPABASE_URL = 'https://srdaietqaprjhpuwovbv.supabase.co';
        var SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYyNDgwOTQxMiwiZXhwIjoxOTQwMzg1NDEyfQ.yBwqUvBsIY3pbITcKgZ99jlEnVfDOhJDOQ6-hHKdaqY';

        var supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY)
    </script>
    <script>
        function a(inn, id, clas) {
            if (inn, id) {
                aa = $(`<${inn}   ${id} class="m${clas}"></${inn}>`);
            } else if (inn) {
                aa = $(`<${inn}></${inn}>`);
            }
            return aa
        };

        function input(id, classx, type, auto, placeholder) {

            aa = $(` <input  type="${type}" ${classx}  placeholder="${placeholder}" autocomplete="${auto}" id="${id}">`);
            return aa
        };

        function srcx(inn, id, clas, src) {
            if (inn, id) {
                aa = $(`<${inn}  ${id} src="${src}" class="m${clas}">`);
            }
            return aa
        };

        function sh(dsfvf) {
            $(dsfvf).css({
                'height': $(dsfvf).width() + 'px'
            })
            $(window).on('resize', function() {
                $(dsfvf).css({
                    'height': $(dsfvf).width() + 'px'
                })
            })
        }

        function sw(dsfvf) {
            $(dsfvf).css({
                'width': $(dsfvf).height() + 'px'
            })
            $(window).on('resize', function() {
                $(dsfvf).css({
                    'width': $(dsfvf).height() + 'px'
                })
            })
        }
    </script>
    <style ux>
@import url("https://canary.animekeyo.com/styles/style.css?clear1-5");
    </style>
    <style mi>
        .m1 {
            display: grid;
            grid-gap: 10px;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        }
        
        input {
            padding: 0.7rem 1rem;
            height: 2.5rem;
            background: var(--r10);
            color: white;
            font-size: 1.5rem;
            border-radius: 5px;
        }
        
        formx {
            padding: 1.3rem 1rem;
            gap: 0.5rem;
            align-items: flex-start!important;
            width: -webkit-fill-available;
        }
        
        .m1x1 {
            padding: 1rem;
            color: var(--c76);
            background: var(--r15);
            border-radius: 5px;
        }
        
        .m1x {
            margin: 10px;
            gap: 10px;
        }
        
        button {
            padding: 1rem 1.2rem;
            background: var(--r10);
            color: white;
            font-size: 1.1rem;
            border-radius: 5px;
            border: none;
            font-family: 'C1';
            width: -webkit-fill-available;
        }
        
        .m5211 {
            height: 40px;
            border-radius: 100rem;
            width: 40px;
        }
        
        .m521 {
            display: flex;
            flex-direction: row;
            justify-content: flex-start;
            padding: 1rem;
            /* margin: 10px; f*/
            gap: 15px;
            border-radius: 10px;
            background: var(--r15);
        }
        
        .m52 {
            margin: 1rem;
            gap: 0.5rem;
        }
    </style>
</head>

<body>


    <script>
        const messaging = firebase.messaging();

        messaging.getToken({
            vapidKey: 'BO_pr8rrSONw5247EO9yl9dfUfz635UjfXd6fb-wiExxOwzorFJag7BbkqQLiBtqvkM3Zcln2bvppZLUCmODLFI'
        }).then((currentToken) => {
            if (currentToken) {
                // Send the token to your server and update the UI if necessary
                // ...
                console.log(currentToken)
            } else {
                // Show permission request UI
                console.log('No registration token available. Request permission to generate one.');
                // ...
            }
        }).catch((err) => {
            console.log('An error occurred while retrieving token. ', err);
            // ...
        });
        messaging.onMessage((payload) => {
            console.log('Message received. ', payload);
            // ...
        });

        // sh('class')
        // a('div','id','class')
        // srcx('img','id','class','src') 
        // .css('','')
        $(document).on('click', '[registerbtn]', function name(params) {
            const email = $('#loginemail').val();
            const password = $('#loginpassword').val();
            if (email) {
                if (password) {
                    firebase.auth().createUserWithEmailAndPassword(email, password)
                        .then((userCredential) => {
                            // Signed in 
                            var user = userCredential.user;
                            // ...
                        })
                        .catch((error) => {
                            var errorCode = error.code;
                            var errorMessage = error.message;
                            swal('', errorMessage)
                        });
                }
            }

        })
        $(document).on('click', '[loginbtn]', function name(params) {
            const email = $('#loginemail').val();
            const password = $('#loginpassword').val();
            if (email) {
                if (password) {
                    firebase.auth().signInWithEmailAndPassword(email, password)
                        .then((userCredential) => {
                            // Signed in 
                            var user = userCredential.user;
                            // ...
                        })
                        .catch((error) => {
                            var errorCode = error.code;
                            var errorMessage = error.message;
                            swal('', errorMessage)
                                // ..
                        });
                }
            }

        })

        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                const currentUser = user.uid;
$(document).on('click','[ruf]',function(){
const ruser = $(this).attr('userid');
const rtype = $(this).attr('rtype');
if(rtype == 'follow'){
    follow(ruser)
    console.log('workinh')
}
});
                function follow(FollowUser){
                    const MainYou = firebase.database().ref('/users/'+ currentUser +'/following/'+ FollowUser);
                    const DataThey = firebase.database().ref('/users/'+ FollowUser +'/followers/'+ currentUser);
                    MainYou.once("value", function(snapshot) {
                        if (snapshot.exists()){
                            MainYou.remove()
                            DataThey.remove()
                        } else {
                            DataThey.update({
                                follow: true,
                            })
                            MainYou.update({
                                follow: true,
                            })
                        }
                    })
                }
                // User is signed in./////
                console.log(user.uid)
                const data = firebase.database().ref('/users/' + user.uid);
                data.update({
                    State: true,
                });
                data.onDisconnect().update({
                    State: false,
                });
                $(document).on('input', '#search-user-input', function() {
                    const val = $(this).val();

                    firebase.database().ref('/users').orderByChild('displayName').startAt(val).once("value", function(snapshot) {
                        $('.m52').html('')
                        snapshot.forEach(function(data) {
                            console.log(data.val());
                            data.val().displayName
                            $('.m52').append(
                                a('div', 'fw ff get-user userid="' + data.val().userid + '"', '521').prepend(
                                    a('div', 'fw fbg ff', '5211').prepend(
                                        ''
                                    ).css('background-image', 'url(' + data.val().avatar + ')'),
                                    a('div', ' ff', '5212').prepend(
                                        data.val().displayName
                                    )
                                )
                            )


                        });
                    });
                })

                data.once("value", snapshot => {
                    if (snapshot.val().page) {
                        $(document).ready(function() {
                            $('[view-page][page="' + snapshot.val().page + '"]').trigger("click");
                        });
                    }
                    $(document).on('click', '[view-page]', function() {
                        const page = $(this).attr('page');

                        if (page) {
                            data.update({
                                page: page,
                            });
                            $('body > div[pagex]').hide()
                            $('[page="' + page + '"]').show()
                        }
                    })
                })
                data.on("value", snapshot => {

                    if (typeof snapshot.val().userid == "undefined") {
                        data.update({
                            userid: user.uid,
                        });
                    }
                    if (typeof snapshot.val().avatar == "undefined") {

                    } else {

                        $('[mainava]').css('background-image', 'url(' + snapshot.val().avatar + ')').attr('userid', user.uid)
                    }

                    if (typeof snapshot.val().displayName == "undefined") {
                        async function myFunction() {
                            const {
                                value: text
                            } = await Swal.fire({
                                title: 'Input DisplayName address',
                                input: 'text',
                                inputLabel: 'Your DisplayName address',
                                inputPlaceholder: 'Enter your DisplayName address'
                            })

                            if (text) {
                                data.update({
                                    displayName: text,
                                });
                            }
                        }
                        myFunction()
                    } else {

                    }
                })
                $('.m3').css('display', 'none')
                $(document).on('click', '[set-avatar]', function() {
                    const href = $(this).attr('href')
                    if (href) {
                        data.update({
                            avatar: href,
                        });
                    }
                })
                $(document).on('click', '[set-banner]', function() {
                        const href = $(this).attr('href')
                        if (href) {
                            data.update({
                                banner: href,
                            });
                        }
                    })
                    //

                $(document).on('click', '[get-user]', function() {
                    $('body > div[pagex]').hide()
                    $('[page="account"]').show()
                    const userid = $(this).attr('userid')
                    if (userid) {
                        const data = firebase.database().ref('/users/' + userid);
                        data.on("value", snapshot => {
                            console.log(snapshot.val())
                            $('.m4').css('display', 'flex')
                            $('[get-user-avatar]').css('background-image', 'url(' + snapshot.val().avatar + ')')
                            $('[get-user-banner]').css('background-image', 'url(' + snapshot.val().banner + ')')
                            $('[get-user-displayname]').text(snapshot.val().displayName)
                            if(currentUser == userid){
                                $('[Follow-Btn]').hide();
                            } else {
                                $('[Follow-Btn]').show().attr('userid',userid).attr('rtype','follow');
                            }
                        })
                    }

                })
            } else {
                // User is signed out.
                console.log('No')
                setTimeout(
                    function name(params) {
                        $('.m3').css('display', 'flex')

                        $('.m3').prepend(a('div', 'fw ff aa fbg', '31')
                            .css('background', 'var(--r5)')
                            .css('justify-content', 'flex-end')
                            .prepend(
                                a('formx', 'ff', '311').prepend(
                                    `<input type="email" ff fw  name="" autocomplete="email" id="loginemail">
        <input  type="password" ff fw  name="" autocomplete="new-password" id="loginpassword">
        <button loginbtn style="background-color:var(--c7);" type="submit">Login</button>
        <button registerbtn style="background-color:rgb(88, 101, 242);" type="submit">Register</button>`
                                )
                            ))
                    }, 1000)
            }
        });

        $('body').prepend(


                $('body').prepend(
                    a('div', 'fw ff fbg pagex page="search"', '5').css('display', 'none').prepend(
                        a('div', 'fw ff fbg', '51').prepend(
                            a('div', 'fw ff fbg', '51').prepend(
                                input('search-user-input', 'ff fw', 'text', '', 'Search user').html('')
                            ),
                            a('div', 'fw ff fbg', '52').prepend(
                                ''
                            )
                        )
                    ),
                    a('div', 'fw ff fbg pagex page="account"', '4')
                    .css('display', 'none')
                    .prepend(
                        a('div', 'fw ff rr fbg', '41')
                        .css('height', '12rem')

                        .css('align-items', 'flex-start')
                        .css('justify-content', 'flex-start')
                        .css('align-content', 'flex-start')
                        .prepend(
                            // Profile Page Banner
                            a('div', 'fw ff rr fbg ', '411')
                            .css('background', 'var(--r10)')
                            .css('height', '9rem')
                            .css('overflow', 'hidden')

                            .prepend(
                                a('div', 'fw ff aa fbg get-user-avatar', '4111').html('')
                                .css('filter', ' blur(40px)')
                                .css('margin', '-100%')
                                .css('top', '-20%')
                                .css('left', '-0%'),
                                a('div', 'fw ff aa fbg get-user-banner', '4111').html('')
                            ),
                            ///Profile Page Avatar 
                            a('div', 'fw aa ff fbg get-user-avatar', '412')
                            .css('width', '6rem')
                            .css('height', '6rem')
                            .css('top', 'unset')
                            .css('bottom', '1px')
                            .css('left', '1.5rem')
                            .css('background-color', 'var(--r15)')
                            .css('box-shadow', '0px 0px 0px 8px var(--r7)')
                            .css('border-radius', '100rem')
                            .prepend(
                                ''
                            ),
                            a('div', 'fw aa ff fbg ruf Follow-Btn', '413')
                            .css('width', 'fit-content')
                            .css('height', 'fit-content')
                            .css('top', 'unset')
                            .css('left', 'unset')
                            .css('bottom', '1px')
                            .css('right', '1.5rem')
                            .css('background', 'rgb(88, 101, 242)')
                            .css('box-shadow', '0px 0px 0px 8px var(--r7)')
                            .css('border-radius', '5px')
                            .css('font-size', '1rem')
                            .css('padding', '8px 16px')
                            .text('Follow')
                        ),
                        a('div', 'ff rr fw', '42').prepend(
                            a('div', 'ff fw rr', '421').prepend(
                                a('div', 'ff get-user-displayname', '4211').text('').css('font-size', '1.3rem')
                            )
                            .css('align-items', 'flex-start')
                            .css('justify-content', 'flex-start')
                            .css('margin', '10px 20px')
                        )
                    )),
                ///Login Acces///
                a('div', 'fw ff fbg pagex', '3').css('display', 'none')
                .prepend(

                    ''

                )
                .css('position', 'fixed')
                .css('bottom', '0')
                .css('overflow', 'hidden')
                .css('z-index', '3')
                .css('left', '0'),
                ///Bottom Bar///
                a('div', 'fw ff', '2').prepend(
                    ''
                )
                .css('position', 'fixed')
                .css('bottom', '0')
                .css('left', '0')
                .css('height', '30px')
                .css('padding', '10px 20px')
                .css('background', 'var(--r5)')
                .css('flex-direction', 'row')
                .css('justify-content', 'space-between')
                .css('z-index', '1').ready(
                    function name(params) {
                        $('body').css('margin-bottom', '75px')
                        const data = [{
                            img: 'https://cdn.discordapp.com/attachments/399102162459688960/870645564621062184/EmojiSymbolsCategory_2acc53c1a6b1d999f2a5ca4c059d9d12_1.png',
                            name: 'view-page page="home"',
                            color: '',
                            br: '',
                        }, {
                            img: 'https://cdn.discordapp.com/attachments/399102162459688960/870645884076052530/Search_f1f1aa5058bd080628dda43c042a9aba.png',
                            name: 'view-page page="search"',
                            color: '',
                            br: '',
                        }, {
                            img: 'https://cdn.discordapp.com/attachments/399102162459688960/870645552629551164/PlusCircle_31499eef2b3ba2b92003ae6d0ec838a1.png',
                            name: 'view-page page="add"',
                            color: '',
                            br: '',
                        }, {
                            img: 'https://cdn.discordapp.com/attachments/399102162459688960/870645575891173446/Bell_3d990f6114a0fd6f02165f5c7a05c77f.png',
                            name: 'view-page page="notfi"',
                            color: '',
                            br: '',
                        }, {
                            img: '',
                            name: 'view-page page="account" mainava get-user',
                            color: 'rgb(88, 101, 242)',
                            br: '100rem',
                        }]
                        $.each(data, function(v, o) {
                            const data = a('div', 'fw fbg ff ' + o.name + '', '21')
                                .prepend(
                                    ''
                                )
                                .css('background-color', o.color)
                                .css('border-radius', o.br)
                                .css('width', '30px')
                                .css('background-image', 'url(' + o.img + ')')
                            $('.m2').append(data)
                        })
                    }
                ),
                ///Bottom Bar///
                a('div', 'rr fw ff pagex page="home"', '1x').prepend(
                    a('div', 'rr fw ff discover-avatars', '1x1').text('Load Avatars'),
                    a('div', 'rr fw ff discover-banners', '1x1').text('Load Banners')
                ),
                a('div', 'rr fw pagex page="home"', '1').css('display', 'none').css('margin', '15px').prepend('').ready(function() {
                    $(document).on('click', '[discover-avatars]', function() {

                        $('.m1').html('').css('grid-template-columns', 'repeat(auto-fill, minmax(150px, 1fr))')
                        $.getJSON('https://pfps.glitch.me/?p=0', function(api) {
                            $.each(api, function(o, v) {
                                $.each(v, function(o, v) {
                                    if (v.img) {
                                        $('.m1').append(
                                            a('div', 'ff rr fw', '11 m12x').prepend(
                                                srcx('img', 'ff nnn', 'idd', v.img),
                                                a('div', 'ff aa fw fbg ', '12x m111')
                                                .css('padding', '100px')
                                                .css('top', '-50%')
                                                .css('left', '-50%')
                                                .css('filter', 'blur(30px)')
                                                .css('background-image', 'url(' + v.img + ')'),
                                                a('div', 'ff rr fw fbg set-avatar href="' + v.img + '"', '112')
                                                .css('background-image', 'url(' + v.img + ')')
                                                .css('margin', '30px')
                                                .css('border-radius', '100rem'), )
                                            .css('overflow', 'hidden')
                                            .css('background-color', 'var(--r11)')
                                            .css('border-radius', '5px')
                                            .ready(function() {
                                                sh('.m12x')
                                                sw('.m111')
                                            }))
                                    } else {}
                                })
                            })
                        })

                    })
                    $(document).on('click', '[discover-banners]', function() {
                        $('.m1').html('').css('grid-template-columns', 'repeat(auto-fill, minmax(350px, 1fr))')
                        $.getJSON('https://banners-api.animekeyo.com/?p=0', function(api) {
                            $.each(api, function(o, v) {
                                $.each(v, function(o, v) {
                                    if (v.img) {
                                        $('.m1').append(
                                            a('div', 'ff rr fw', '11 m12x').prepend(
                                                srcx('img', 'ff fw set-banner href="' + v.img + '"', 'idd', v.img))
                                            .css('overflow', 'hidden')
                                            .css('background-color', 'var(--r11)')
                                            .css('border-radius', '5px')
                                            .ready(function() {

                                            }))
                                    } else {}
                                })
                            })
                        })

                    })
                })

            )
            .css('background-color', 'var(--r7)')
    </script>
</body>

</html>