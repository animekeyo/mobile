<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="/mobile-manifest.json?clear-21553">
    <link rel="icon" href="/icon-192x192.png">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('service worker registered'))
                .catch(err => console.log('service worker not registered', err));
        }
    </script>
    <title>Anime Keyo</title>
    <script src="https://canary.animekeyo.com/scripts/jquery.js"></script>
    <!---//////////////////////////------jquery------///////////////////////////--->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-messaging.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-storage.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.7/dist/sweetalert2.all.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="https://canary.animekeyo.com/scripts/firebase.js"></script>

    <script>
        function a(inn, id, clas) {
            if (inn, id) {
                aa = $(`<${inn}   ${id} class="m${clas}"></${inn}>`);
            } else if (inn) {
                aa = $(`<${inn}></${inn}>`);
            }
            return aa
        };

        function input(id, classx, type, auto, placeholder) {

            aa = $(` <input  type="${type}" ${classx}  placeholder="${placeholder}" autocomplete="${auto}" id="${id}" required>`);
            return aa
        };

        function srcx(inn, id, clas, src) {
            if (inn, id) {
                aa = $(`<${inn}  ${id} src="${src}" class="m${clas}">`);
            }
            return aa
        };

        function sh(dsfvf) {
            setTimeout(function name(params) {
                $(dsfvf).css({
                    'height': $(dsfvf).width() + 'px'
                })
            }, 2000)
            $(dsfvf).css({
                'height': $(dsfvf).width() + 'px'
            })
            $(window).on('resize', function() {
                $(dsfvf).css({
                    'height': $(dsfvf).width() + 'px'
                })
            })
        }

        function sw(dsfvf) {
            $(dsfvf).css({
                'width': $(dsfvf).height() + 'px'
            })
            $(window).on('resize', function() {
                $(dsfvf).css({
                    'width': $(dsfvf).height() + 'px'
                })
            })
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <style ux>
        @import url("https://canary.animekeyo.com/styles/style.css?clear1-5");
    </style>
    <style mi>
         :root {
            --v1: rgb(88, 101, 242);
        }
        
        .m1 {
            display: grid;
            grid-gap: 10px;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        }
        
        .mn6 {
            height: fit-content;
            border-bottom: 4rem solid var(--r7);
        }
        
        .mn81 {
            padding: 1rem;
        }
        
        .m21 svg {
            fill: white;
            width: -webkit-fill-available;
            height: -webkit-fill-available;
        }
        
        select,
        input {
            padding: 0.7rem 1rem;
            height: 2.5rem;
            background: var(--r10);
            color: white;
            font-size: 1.2rem;
            border-radius: 5px;
            font-family: 'C1';
        }
        
        select:focus,
        input:focus {
            box-shadow: 0px 0px 0px 3px var(--c7);
        }
        
        select::placeholder,
        input::placeholder {
            color: white;
            letter-spacing: 1px;
        }
        
        select {
            border: unset;
            height: auto;
        }
        
        select:focus-visible {
            outline: unset;
        }
        
        formx {
            padding: 1.3rem 1rem;
            gap: 0.5rem;
            align-items: flex-start!important;
            width: -webkit-fill-available;
        }
        
        .m1x1 {
            padding: 1rem;
            color: var(--c76);
            background: var(--r15);
            border-radius: 5px;
        }
        
        .m1x {
            margin: 10px;
            gap: 10px;
        }
        
        button {
            padding: 1rem 1.2rem;
            background: var(--r10);
            color: white;
            font-size: 1.1rem;
            border-radius: 5px;
            border: none;
            font-family: 'C1';
            width: -webkit-fill-available;
        }
        
        .m5211 {
            height: 40px;
            border-radius: 100rem;
            width: 40px;
        }
        
        .m521 {
            display: flex;
            flex-direction: row;
            justify-content: flex-start;
            padding: 1rem;
            /* margin: 10px; f*/
            gap: 15px;
            border-radius: 10px;
            background: var(--r15);
        }
        
        .m52 {
            margin: 1rem;
            gap: 0.5rem;
        }
        
        [fff] {
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            flex-direction: column;
            flex-wrap: nowrap;
            align-content: center;
            justify-content: flex-start;
            align-items: flex-start;
        }
        
        [fww] {
            width: -webkit-fill-available;
        }
        
        .mn32 {
            gap: 0.6rem;
            overflow-y: scroll;
        }
        
        .mn321 {
            height: 2.5rem;
            flex-direction: row;
            justify-content: flex-start;
            align-items: center;
            gap: 0.5rem;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--r15);
        }
        
        .mn3211 {
            height: 40px;
            width: 40px;
            background-color: white;
            border-radius: 100rem;
        }
        
        .mn3212 {
            max-width: max-content;
        }
        
        .mn4121 {
            height: 68px;
            width: 68px;
            border: 3px solid var(--r5);
            margin: 3px;
            background-color: var( --v1);
            border-radius: 100rem;
        }
        
        .mn412 {
            padding: 1rem;
            display: flex;
            flex-direction: row;
            align-items: center;
            background: var(--r5);
        }
        
        .mn4122x {
            width: fit-content;
            height: fit-content;
            padding: 0.5rem 0.6rem;
            background-color: var(--v1);
            border-radius: 5px;
        }
        
        .mn4121x {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 01rem;
        }
        
        .mn41221 svg {
            fill: white;
            height: 22px;
            width: 22px;
        }
        
        .mn41221 {
            font-size: 1.3rem;
            display: flex;
            flex-direction: row;
            gap: 5px;
        }
        
        .mn412221 {
            text-transform: uppercase;
            font-size: 0.75rem;
            color: hsl(0deg 0% 70%);
        }
        
        .mn4122 {
            gap: 0.3rem;
        }
        
        .mn41222 {
            gap: 0.1rem;
        }
        
        .mn412221.n23xdi {
            font-size: 0.9rem;
            color: white;
        }
        
        .mn4122x svg {
            fill: white;
            width: 1.5rem;
            height: 1.5rem;
        }
        
        .m21[mainava] {
            width: 24px!important;
            height: 24px!important;
            border: 3px solid white;
        }
        
        sd {
            color: var(--v1);
        }
        
        .midetx {
            width: 20px;
            height: 20px;
            position: absolute;
            bottom: -3px;
            right: -3px;
            background-color: var(--r5);
            border-radius: 100px;
            box-shadow: 0px 0px 0px 4px var(--r5);
        }
        
        .midetx.bannerxto {
            top: 10px;
            right: 10px;
            bottom: unset;
        }
        
        .midetx svg {
            width: 14px;
            height: 14px;
            fill: var(--r5);
        }
        
        .mn61111 {
            height: 40px;
            width: 40px;
            background-color: black;
            border-radius: 100px;
        }
        
        .mn6111,
        .mn611 {
            display: flex;
            flex-direction: row;
        }
        
        .mn6112 {
            padding: 6px 10px;
            background: var(--v1);
            border-radius: 5px;
            text-transform: uppercase;
            font-size: 0.9rem;
        }
        
        .mn611 {
            display: flex;
            justify-content: space-between;
            width: -webkit-fill-available;
            font-size: 1rem;
            gap: 1rem;
            min-height: 40px;
        }
        
        .mn61112 {
            width: -webkit-fill-available;
            word-break: break-word;
            margin-left: 50px;
        }
        
        .mn61 {
            gap: 0.5rem;
        }
        
        c {
            FONT-WEIGHT: 900;
            font-family: sans-serif;
            color: var(--v1);
        }
        
        input[type="submit"] {
            padding: 1.5rem;
            background: var(--c7);
        }
        
        form {
            gap: 0.5rem;
        }
        
        .mn711 {
            min-height: 10rem;
        }
        
        .mn711 svg {
            fill: white;
            padding: 1rem;
            border-radius: 100rem;
            background: hsl(210deg 22% 7% / 50%);
            width: 50px;
            height: 50px;
        }
        
        .mnmxc1 {
            padding-bottom: 4rem;
            margin: 1rem;
            margin-bottom: 7rem;
            gap: 0.7rem;
        }
        
        .mnmxc11 img {
            border-radius: 10px;
            border: 2px solid var(--r15);
            min-height: 5rem;
            background: var(--r15);
        }
        
        .mnmxc111 {
            font-size: 1.8rem;
        }
        
        .mnmxc1121 {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 100rem;
        }
        
        .mnmxc1122 {
            font-size: 1.2rem;
            width: fit-content;
        }
        
        .mnmxc112 {
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            align-content: center;
            justify-content: flex-start;
            align-items: center;
            gap: 0.5rem;
            margin: 10px 0rem;
        }
        
        .mnmxc113 {
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            align-content: center;
            justify-content: space-between;
            align-items: center;
            gap: 0.5rem;
            margin: 0.5rem 0rem;
        }
        
        .mnmxc1132 {
            font-size: 2rem;
            text-transform: uppercase;
        }
        
        .mnmxc1132:before {
            content: "Likes";
            margin-right: 0.2rem;
            font-size: 1rem;
        }
        
        .mnmxc1131 svg {
            fill: white;
            width: 40px;
            height: 40px;
        }
        
        .mnmxc1131 {
            height: fit-content;
            width: fit-content;
        }
        /* Hide scrollbar for Chrome, Safari and Opera */
        
        *::-webkit-scrollbar {
            display: none!important;
        }
        /* Hide scrollbar for IE, Edge and Firefox */
        
        * {
            -ms-overflow-style: none!important;
            /* IE and Edge */
            scrollbar-width: none!important;
            /* Firefox */
        }
    </style>
</head>

<body>


    <script>
        AOS.init();
        const messaging = firebase.messaging();
        ////////////////////////////////
        icon_heart = `<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M13.35 20.13c-.76.69-1.93.69-2.69-.01l-.11-.1C5.3 15.27 1.87 12.16 2 8.28c.06-1.7.93-3.33 2.34-4.29 2.64-1.8 5.9-.96 7.66 1.1 1.76-2.06 5.02-2.91 7.66-1.1 1.41.96 2.28 2.59 2.34 4.29.14 3.88-3.3 6.99-8.55 11.76l-.1.09z"/></svg>`
        icon_add = `<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4 11h-3v3c0 .55-.45 1-1 1s-1-.45-1-1v-3H8c-.55 0-1-.45-1-1s.45-1 1-1h3V8c0-.55.45-1 1-1s1 .45 1 1v3h3c.55 0 1 .45 1 1s-.45 1-1 1z"/></svg>`;
        icon_notification = `<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-1.29 1.29c-.63.63-.19 1.71.7 1.71h13.17c.89 0 1.34-1.08.71-1.71L18 16z"/></svg>`;

        //////////////////////////


        // sh('class')
        // a('div','id','class')
        // srcx('img','id','class','src') 
        // .css('','')
        $(document).on('click', '[registerbtn]', function name(params) {
            const email = $('#loginemail').val();
            const password = $('#loginpassword').val();
            if (email) {
                if (password) {

                    firebase.auth().createUserWithEmailAndPassword(email, password)
                        .then((userCredential) => {
                            // Signed in 
                            const user = userCredential.user;
                            // ...
                        })
                        .catch((error) => {
                            const errorCode = error.code;
                            const errorMessage = error.message;
                            swal('', errorMessage)
                        });
                }
            }

        })
        $(document).on('click', '[loginbtn]', function name(params) {
            const email = $('#loginemail').val();
            const password = $('#loginpassword').val();
            if (email) {
                if (password) {
                    firebase.auth().signInWithEmailAndPassword(email, password)
                        .then((userCredential) => {
                            // Signed in 
                            const user = userCredential.user;
                            // ...
                        })
                        .catch((error) => {
                            const errorCode = error.code;
                            const errorMessage = error.message;
                            swal('', errorMessage)
                                // ..
                        });
                }
            }

        })

        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                var v = window.location.pathname;
                console.log(v)


                const currentUser = user.uid;
                const CreateLink = new Date().getTime();
                const data = firebase.database().ref('/users/' + user.uid);
                $(document).on('click', '[like-post]', function() {
                    const userid = $(this).attr('userid');
                    const postid = $(this).attr('postid');
                    if (postid && userid) {
                        const datav = firebase.database().ref('/users/' + userid + '/posts')
                            .child(postid)
                            .child('likes')
                            .child(currentUser);
                        datav.once("value", function(snapshot) {
                            if (snapshot.exists()) {
                                datav.remove()
                            } else {
                                datav.update({
                                    like: true,
                                    userid: currentUser
                                })
                            }
                        })


                    }
                })

                function likesData(userid, link, apply, type) {
                    if (userid && link && apply && type) {
                        const datav = firebase.database().ref('/users/' + userid + '/posts/' + link + '/likes');
                        if (type == 'fill') {

                            datav.child(currentUser).on('value', function(dx) {
                                if (dx.exists()) {
                                    apply.css('fill', 'var(--c19)')
                                } else {
                                    apply.css('fill', 'var(--c6)')
                                }
                            })
                        }
                        if (type == 'count') {
                            datav.on('value', function(dx) {
                                apply.text(dx.numChildren());
                            })

                            // .snapshot.forEach(function(childSnapshot) {

                            // })
                        }
                    }
                }
                $('#uploadPostFile').on('click', function name(params) {
                    $('uploadPostFile').remove();
                    $('[uploadPostFile]').remove();
                    $('body').prepend(`<uploadPostFile link=""></uploadPostFile><input accept="image/*"  uploadPostFile type="file" nnn id="files" name="files[]" multiple />`)
                    $('[uploadPostFile]').trigger('click');
                })
                $(document).on('input', '[uploadPostFile]', function() {
                    const file = $(this)[0].files[0];
                    console.log(file)
                    const storageRef = firebase.storage().ref('/users/' + currentUser + '/files/' + CreateLink + file.name);
                    // Get the file from DOM


                    //dynamically set reference to the file name

                    //put request upload file to firebase storage
                    storageRef.put(file).then(function(snapshot) {

                        console.log("File Uploaded")
                        storageRef.getDownloadURL().then((downloadURL) => {

                            $('#uploadPostFile').css('background-image', 'url(' + downloadURL + ')'),
                                console.log('File available at', downloadURL);
                            $('uploadPostFile').attr('link', downloadURL)
                            sh('.mn711')
                            $('[uploadPostFile]').remove();
                            $('uploadPostFile').remove();
                        });

                    });

                })

                $('form.mn71').submit(function(e) {
                    e.preventDefault();
                    const title = $('#uploadPostTitle').val();
                    const type = $('#uploadPostType').val();
                    const file = $('#uploadPostFile').css('background-image');
                    const filex = file.replace('url(', '').replace(')', '').replace(/\"/gi, "");

                    if (filex == 'none') {
                        swal('No Image Selected')
                    } else {

                        $('#uploadPostTitle').val('')
                        console.log(filex)
                        uploadPost(filex, title, type)
                        swal('', 'Posted')
                        $('#uploadPostFile').css('background-image', '');
                    }

                });

                function uploadPost(url, title, type) {
                    if (type == 'post') {
                        data.child('posts').child(CreateLink).update({
                            title: title,
                            postid: CreateLink,
                            image: url,
                            userid: currentUser,
                        })
                    }
                };

                function notinfo(userid, notid, type, apply) {
                    firebase.database().ref('/users/' + userid + '/notifications/' + notid)
                        .on("value", function(snapshot) {
                            if (type == 'title') {
                                apply.text(snapshot.val().title);
                            } else if (type == 'userid') {
                                apply.attr('userid', snapshot.val().userid);
                            } else {
                                console.log('ERROR notinfo')
                            }
                        })
                }

                function postinfo(userid, postid, type, apply) {
                    firebase.database().ref('/users/' + userid + '/posts/' + postid)
                        .on("value", function(snapshot) {
                            if (type == 'title') {
                                apply.text(snapshot.val().title);
                            } else if (type == 'image') {
                                apply.attr('src', snapshot.val().image);
                            } else {
                                console.log('ERROR POSTINFO')
                            }
                        })
                }




                $(document).on('click', '[view-page][page="home"]', function() {

                    $('.mn81').remove()
                    $('.mn8').append(
                        a('div', ' fff fww', 'n81').prepend(''),

                    )
                    $('.mn81').html('')
                    const gli = firebase.database().ref('/everyone/');
                    gli.once("value", function(snapshot) {
                        console.log(snapshot.numChildren())
                        const ccs = snapshot.numChildren();
                        const count = 50;
                        gli.orderByKey().limitToLast(count).once("value", function(snapshot) {

                            snapshot.forEach(function(data) {

                                const postid = data.val().postid
                                const userid = data.val().userid
                                console.log(postid + "  " + userid)
                                $('[postx="' + postid + '"]').remove()
                                const datax = `<div data-aos="fade-up" fww="" postx="${postid}" class="mnmxc11" style="">
    <div get-user userid="${userid}" fww="" class="mnmxc112">
        <div user-avatarx userid="${userid}" fbg="" class="mnmxc1121" style="background-image: url()"></div>
        <div display-name userid="${userid}" class="mnmxc1122"></div>
    </div><img userid="${userid}" postid="${postid}" fww="" src="">
    <div class="mnmxc113">
        <div like-post userid="${userid}" postid="${postid}" class="mnmxc1131 ">${icon_heart}</div>
        <div like-count postid="${postid}" class="mnmxc1132">0</div>
    </div>
    <div post-titlex userid="${userid}" postid="${postid}" class="mnmxc111"></div>
</div>`;
                                $('.mn81').prepend(datax);
                                userdata($('[user-avatarx][userid="' + userid + '"]'), 'avatar', userid)
                                userdata($('[display-name][userid="' + userid + '"]'), 'displayName', userid)
                                postinfo(userid, postid, 'image', $('img[userid="' + userid + '"][postid="' + postid + '"]'))
                                postinfo(userid, postid, 'title', $('[post-titlex][userid="' + userid + '"][postid="' + postid + '"]'))
                                likesData(userid, postid, $('[like-post][postid="' + postid + '"] > svg'), 'fill')
                                likesData(userid, postid, $('[like-count][postid="' + postid + '"]'), 'count')

                            })

                        })
                    })

                })
                $(document).on('click', '[view-page][page="notifications"]', function() {
                        $('.mn61').html(' ')

                        data.child('notifications').once("value", function(snapshot) {


                            snapshot.forEach(function(childSnapshot) {
                                const key = childSnapshot.key;

                                $('[keyx="' + key + '"]').remove()
                                const childData = childSnapshot.val();
                                const type = childSnapshot.val().type;
                                var fhsdkdfoewopidfdfgjkldf;
                                if (type == 'follow') {
                                    fhsdkdfoewopidfdfgjkldf = 'is following you now.';
                                } else if (type == 'like') {
                                    fhsdkdfoewopidfdfgjkldf = 'liked your post.';
                                } else {
                                    fhsdkdfoewopidfdfgjkldf = 'just posted something new!';
                                }
                                const datacv =
                                    `<div fff="" keyx="${key}" class="mn611">
    <div fw="" rr="" fff="" class="mn6111">
        <div user-avatarxd userid="${childData.userid}" aa fw fff fbg class="mn61111">

        </div>
        <div c class="mn61112">
            <c c get-user display-namexd userid="${childData.userid}" class="mn611121">
            </c> 

        ${fhsdkdfoewopidfdfgjkldf}</div>
    </div>
    <div ff get-user userid="${childData.userid}" class="mn6112">View</div>
</div>`;
                                $('.mn61').prepend(datacv)
                                userdata($('[user-avatarxd][userid="' + childData.userid + '"]'), 'avatar', childData.userid)
                                userdata($('[display-namexd][userid="' + childData.userid + '"]'), 'displayName', childData.userid)
                                    //  const data = firebase.database().ref('/users/' + childData.userid);
                                    // data.once("value", function(snapshot) { const aas = snapshot.val(); const name = aas.displayName; const avatar = aas.avatar; $('[keyx="' + key + '"]').remove() if (childData.type == 'follow') { $('.mn61').prepend( a('div', ' fff keyx="' + key + '"', 'n611').prepend( a('div', 'fw rr fff', 'n6111').prepend( a('div', 'aa fw fff fbg', 'n61111').prepend( '' ).css('background-image', 'url(' + avatar + ')'), a('div', 'c', 'n61112').prepend( a('c', 'c get-user userid="' + childData.userid + '"', 'n611121').prepend(name), ' started following you.' ) ), a('div', 'ff get-user userid="' + childData.userid + '"', 'n6112').prepend( 'View' ) ) ) } if (childData.type == 'like') { if (childData.userid == currentUser) { } else { $('.mn61').prepend( a('div', ' fff keyx="' + key + '"', 'n611').prepend( a('div', 'fw rr fff', 'n6111').prepend( a('div', 'aa fw fff fbg', 'n61111').prepend( '' ).css('background-image', 'url(' + avatar + ')'), a('div', 'c', 'n61112').prepend( a('c', 'c get-user userid="' + childData.userid + '"', 'n611121').prepend(name), ' liked your post.' ) ), a('div', 'ff get-user userid="' + childData.userid + '"', 'n6112').prepend( 'View' ) ) ) } } })

                            });
                        }, function(error) {
                            console.error(error);
                        });



                    })
                    //function to save file
                    // <input deletexinput type="file" nnn id="files" name="files[]" multiple />
                $(document).on('click', '[uploadfilex]', function() {
                    const type = $(this).attr('type')
                    $('body').prepend(`<input deletexinput accept="image/*" typex="${type}" type="file" nnn id="files" name="files[]" multiple />`)
                    $('[deletexinput]').trigger('click');
                })
                $(document).on('input', '[deletexinput]', function() {
                    // Created a Storage Reference with root dir

                    const file = $(this)[0].files[0];
                    const type = $(this).attr('typex');

                    if (type) {

                        const storageRef = firebase.storage().ref('/users/' + currentUser + '/' + type + '/p1.jpg');
                        // Get the file from DOM


                        //dynamically set reference to the file name

                        //put request upload file to firebase storage
                        storageRef.put(file).then(function(snapshot) {

                            alert("File Uploaded")
                            storageRef.getDownloadURL().then((downloadURL) => {
                                $('[deletexinput]').remove();
                                console.log('File available at', downloadURL);
                                if (type == 'avatar') {
                                    data.update({
                                        avatar: downloadURL
                                    })
                                }
                                if (type == 'banner') {
                                    data.update({
                                        banner: downloadURL
                                    })
                                }

                            });

                        });
                    }


                })

                messaging.getToken({
                    vapidKey: 'BO_pr8rrSONw5247EO9yl9dfUfz635UjfXd6fb-wiExxOwzorFJag7BbkqQLiBtqvkM3Zcln2bvppZLUCmODLFI'
                }).then((currentToken) => {
                    if (currentToken) {
                        // Send the token to your server and update the UI if necessary
                        // ...
                        data.update({
                            pushToken: currentToken,
                        })

                    } else {
                        // Show permission request UI
                        console.log('No registration token available. Request permission to generate one.');
                        // ...
                    }
                }).catch((err) => {
                    console.log('An error occurred while retrieving token. ', err);
                    // ...
                });
                messaging.onMessage((payload) => {
                    navigator.vibrate(200);
                    console.log('Message received. ', payload);

                    // ...
                });
                $(document).on('click', '[ruf]', function() {
                    const ruser = $(this).attr('userid');
                    const rtype = $(this).attr('rtype');
                    if (rtype == 'follow') {
                        follow(ruser)
                    }
                });

                function follow(FollowUser) {
                    const MainYou = firebase.database().ref('/users/' + currentUser + '/following/' + FollowUser);
                    const DataThey = firebase.database().ref('/users/' + FollowUser + '/followers/' + currentUser);
                    MainYou.once("value", function(snapshot) {
                        if (snapshot.exists()) {
                            MainYou.remove()
                            DataThey.remove()
                        } else {
                            DataThey.update({
                                follow: true,
                            })
                            MainYou.update({
                                follow: true,
                            })
                        }
                    })
                }

                function checkfollow(FollowUser, DEX) {
                    const MainYou = firebase.database().ref('/users/' + currentUser + '/following/' + FollowUser);
                    MainYou.on("value", function(snapshot) {
                        if (snapshot.exists()) {
                            DEX.html(`
<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24"><g><rect fill="none" height="24" width="24"/><rect fill="none" height="24" width="24"/></g><g><path d="M14,8c0-2.21-1.79-4-4-4S6,5.79,6,8s1.79,4,4,4S14,10.21,14,8z M2,18v1c0,0.55,0.45,1,1,1h14c0.55,0,1-0.45,1-1v-1 c0-2.66-5.33-4-8-4S2,15.34,2,18z M18,10h4c0.55,0,1,0.45,1,1v0c0,0.55-0.45,1-1,1h-4c-0.55,0-1-0.45-1-1v0 C17,10.45,17.45,10,18,10z"/></g></svg>`).css('background', 'var(--c19)')
                        } else {
                            DEX.html(`
<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V8c0-.55-.45-1-1-1s-1 .45-1 1v2H2c-.55 0-1 .45-1 1s.45 1 1 1h2v2c0 .55.45 1 1 1s1-.45 1-1v-2h2c.55 0 1-.45 1-1s-.45-1-1-1H6zm9 4c-2.67 0-8 1.34-8 4v1c0 .55.45 1 1 1h14c.55 0 1-.45 1-1v-1c0-2.66-5.33-4-8-4z"/></svg>`).css('background', 'var(--v1)')

                        }
                    })
                }


                function userdata(div, type, useridxz) {
                    if (useridxz && type && div) {
                        const data = firebase.database().ref('/users/' + useridxz);
                        data.on("value", snapshot => {



                            if (type == 'displayName') {
                                div.text(snapshot.val().displayName)
                            } else if (type == 'avatar') {
                                div.css('background-image', 'url(' + snapshot.val().avatar + ')')
                            } else if (type == 'banner') {
                                div.css('background-image', 'url(' + snapshot.val().banner + ')')
                            } else if (type == 'userid') {
                                div.text(snapshot.val().userid)
                            } else if (type == 'attr-userid') {
                                div.attr('userid', snapshot.val().userid)
                            } else if (type == 'followers-count') {
                                data.child('followers').on("value", snapshot => {
                                    div.text(snapshot.numChildren())
                                })

                            } else if (type == 'State') {
                                if (snapshot.val().State == true) {
                                    div.css('box-shadow', '0px 0px 0px 3px var(--c7)')
                                } else if (snapshot.val().State == false) {
                                    div.css('box-shadow', '0px 0px 0px 3px var(--c19)')
                                } else {
                                    div.css('box-shadow', '0px 0px 0px 3px var(--c19)')
                                }
                            } else if (type == 'StateColor') {
                                if (snapshot.val().State == true) {
                                    div.css('background-color', 'var(--c7)')
                                } else if (snapshot.val().State == false) {
                                    div.css('background-color', 'var(--c19)')
                                } else {
                                    div.css('background-color', 'var(--c19)')
                                }
                            } else if (type == 'following-count') {
                                data.child('following').on("value", snapshot => {
                                    div.text(snapshot.numChildren())
                                })
                            } else if (type == 'verified') {
                                data.child('badges').on("value", snapshot => {
                                    if (snapshot.exists()) {
                                        if (snapshot.val().verified) {
                                            div.append(`
<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24"><g><rect fill="none" height="24" width="24"/><rect fill="none" height="24" width="24"/></g><g><path d="M23,12l-2.44-2.79l0.34-3.69l-3.61-0.82L15.4,1.5L12,2.96L8.6,1.5L6.71,4.69L3.1,5.5L3.44,9.2L1,12l2.44,2.79l-0.34,3.7 l3.61,0.82L8.6,22.5l3.4-1.47l3.4,1.46l1.89-3.19l3.61-0.82l-0.34-3.69L23,12z M9.38,16.01L7,13.61c-0.39-0.39-0.39-1.02,0-1.41 l0.07-0.07c0.39-0.39,1.03-0.39,1.42,0l1.61,1.62l5.15-5.16c0.39-0.39,1.03-0.39,1.42,0l0.07,0.07c0.39,0.39,0.39,1.02,0,1.41 l-5.92,5.94C10.41,16.4,9.78,16.4,9.38,16.01z"/></g></svg>`)
                                        } else {

                                        }
                                    }

                                })
                            } else {
                                console.log('Error [userdata]2')
                            }
                        })

                    } else {
                        console.log('Error [userdata]1')
                    }
                }
                /////////////////////////////
                $(document).on('click', '[get-user]', function() {

                        const userid = $(this).attr('userid')

                        if (userid) {

                            const datac = a('div', 'fw', 'n41').prepend(
                                a('div', 'fw fff rr fbg', 'n411').prepend( /// Profile Banner

                                ).css({
                                    'height': ' 130px',
                                    'background-color': 'var(--v1)',
                                }),
                                a('div', 'fw fff', 'n412').prepend( /// Profile Meta

                                    a('div', 'fw fff', 'n4121x').prepend( /// Profile Meta
                                        a('div', 'fw fff rr fbg', 'n4121').prepend( /// Profile PIC

                                        ),
                                        a('div', ' fff', 'n4122').prepend( /// Profile Meta
                                            a('div', ' ', 'n41221').text(''),
                                            a('div', ' fff', 'n41222').prepend( /// Profile 
                                                a('div', ' ', 'n412221 n23xdi').prepend( /// Profile 
                                                    'Followers <sd Followers-Count>1</sd>'),
                                                a('div', ' ', 'n412221').prepend( /// Profile 
                                                    'Following <sd Following-Count>1</sd>')
                                            )
                                        )
                                    ),

                                )
                            );
                            $('.mn4').html(datac)
                            userdata($('.mn41221'), 'displayName', userid)
                            userdata($('.mn41221'), 'verified', userid)

                            userdata($('.mn4121'), 'avatar', userid)

                            userdata($('.mn4121'), 'State', userid)
                            userdata($('.mn411'), 'banner', userid)
                            userdata($('[Following-Count]'), 'following-count', userid)
                            userdata($('[Followers-Count]'), 'followers-count', userid)

                            $('.mn41').append(
                                a('div', ' fff fww', 'nmxc1').prepend('')
                            )
                            $('.mnmxc1').html('')
                            const gli = firebase.database().ref('/users/' + userid);
                            gli.child('posts').once("value", function(snapshot) {

                                snapshot.forEach(function(data) {
                                    const postid = data.val().postid
                                    gli.once("value", function(snapshotx) {
                                        $('.mnmxc1').prepend(
                                            a('div', '  fww', 'nmxc11')
                                            .hide()
                                            .prepend(
                                                a('div', 'fww', 'nmxc112').prepend(
                                                    a('div', ' fbg', 'nmxc1121').prepend(
                                                        ''
                                                    ).css('background-image', 'url(' + snapshotx.val().avatar + ')'),
                                                    a('div', ' ', 'nmxc1122').text(snapshotx.val().displayName)
                                                ),
                                                `<img fww src="${data.val().image}">`,
                                                a('div', ' ', 'nmxc113').prepend(
                                                    a('div', 'like-post userid="' + userid + '" postid="' + postid + '" ', 'nmxc1131 ').prepend(
                                                        icon_heart
                                                    ).ready(
                                                        function name(params) {
                                                            likesData(userid, postid, $('[like-post][postid="' + postid + '"] > svg'), 'fill')

                                                        }),
                                                    a('div', 'like-count postid="' + postid + '"', 'nmxc1132').text(
                                                        '0'
                                                    ).ready(
                                                        function name(params) {
                                                            likesData(userid, postid, $('[like-count][postid="' + postid + '"]'), 'count')

                                                        }),
                                                ),
                                                a('div', ' ', 'nmxc111').text(data.val().title)
                                            ).ready(function name(params) {
                                                $('.mnmxc11').fadeIn('slow');
                                            })

                                        )
                                    })

                                })
                            })

                            if (currentUser == userid) {
                                $('.mn412').append(a('div', 'fw ff', 'n4122x').html( /// Profile Follow
                                    `
<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24"><rect fill="none" height="24" width="24"/><path d="M19.5,12c0-0.23-0.01-0.45-0.03-0.68l1.86-1.41c0.4-0.3,0.51-0.86,0.26-1.3l-1.87-3.23c-0.25-0.44-0.79-0.62-1.25-0.42 l-2.15,0.91c-0.37-0.26-0.76-0.49-1.17-0.68l-0.29-2.31C14.8,2.38,14.37,2,13.87,2h-3.73C9.63,2,9.2,2.38,9.14,2.88L8.85,5.19 c-0.41,0.19-0.8,0.42-1.17,0.68L5.53,4.96c-0.46-0.2-1-0.02-1.25,0.42L2.41,8.62c-0.25,0.44-0.14,0.99,0.26,1.3l1.86,1.41 C4.51,11.55,4.5,11.77,4.5,12s0.01,0.45,0.03,0.68l-1.86,1.41c-0.4,0.3-0.51,0.86-0.26,1.3l1.87,3.23c0.25,0.44,0.79,0.62,1.25,0.42 l2.15-0.91c0.37,0.26,0.76,0.49,1.17,0.68l0.29,2.31C9.2,21.62,9.63,22,10.13,22h3.73c0.5,0,0.93-0.38,0.99-0.88l0.29-2.31 c0.41-0.19,0.8-0.42,1.17-0.68l2.15,0.91c0.46,0.2,1,0.02,1.25-0.42l1.87-3.23c0.25-0.44,0.14-0.99-0.26-1.3l-1.86-1.41 C19.49,12.45,19.5,12.23,19.5,12z M12.04,15.5c-1.93,0-3.5-1.57-3.5-3.5s1.57-3.5,3.5-3.5s3.5,1.57,3.5,3.5S13.97,15.5,12.04,15.5z"/></svg>`
                                ))
                                $('.mn4121').prepend(
                                    a('div', 'ff uploadfilex type="avatar"', 'idetx').html('<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><circle cx="12" cy="12" r="3"/><path d="M20 4h-3.17l-1.24-1.35c-.37-.41-.91-.65-1.47-.65H9.88c-.56 0-1.1.24-1.48.65L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 13c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg>').ready(function() {
                                        userdata($('.midetx'), 'StateColor', userid)
                                    })
                                )
                                $('.mn411').prepend(
                                    a('div', 'ff uploadfilex type="banner"', 'idetx bannerxto').html('<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><circle cx="12" cy="12" r="3"/><path d="M20 4h-3.17l-1.24-1.35c-.37-.41-.91-.65-1.47-.65H9.88c-.56 0-1.1.24-1.48.65L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 13c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg>').ready(function() {
                                        userdata($('.bannerxto'), 'StateColor', userid)
                                    })
                                )
                            } else {
                                $('.mn412').append(a('div', 'fw fff ruf rtype="follow" userid="' + userid + '"', 'n4122x')
                                    .html('')).ready(function() {
                                    checkfollow(userid, $('[ruf][rtype="follow"][userid="' + userid + '"]'))
                                });
                                $('.mn4121').prepend(
                                    a('div', 'ff', 'idetx').html('').ready(function() {
                                        userdata($('.midetx'), 'StateColor', userid)
                                    })
                                )
                            }
                            $('body > div[pagex]').hide()
                            $('[page="account"]').show()
                        }

                    })
                    // User is signed in./////
                console.log(user.uid)



                data.update({
                    State: true,
                });
                data.onDisconnect().update({
                    State: false,
                });

                $(document).on('input', '#searchbox', function() {
                    const val = $(this).val();
                    if (val == '') {
                        $('[search-results]').html('')
                    } else {
                        firebase.database().ref('/users').orderByChild('displayName').startAt(val).endAt(val + "\uf8ff").once("value", function(snapshot) {
                            $('[search-results]').html('')
                            snapshot.forEach(function(data) {
                                console.log();

                                $('[search-results]').append(
                                    a('div', 'fw fff get-user userid="' + data.val().userid + '"', 'n321').prepend( // Main div for name and avatar
                                        a('div', 'fw fff fbg', 'n3211').css('background-image', 'url(' + data.val().avatar + ')').html(''), // Avatar
                                        a('div', 'fw fff', 'n3212').text(data.val().displayName) // Display Name
                                    )
                                );
                            });
                        });

                    }


                })

                data.once("value", snapshot => {
                    if (snapshot.val().page) {
                        $(document).ready(function() {
                            $('[view-page][page="' + snapshot.val().page + '"]').trigger("click");
                        });
                    }
                    $(document).on('click', '[view-page]', function() {
                        const page = $(this).attr('page');
                        navigator.vibrate(70);
                        if (page) {
                            data.update({
                                page: page,
                            });
                            $('body > div[pagex]').hide()
                            $('div[view-page] > svg').css('fill', 'var(--c6)')
                            $('div[view-page]').css('border-color', 'var(--c6)')
                            $('[page="' + page + '"]').show()
                            $('[page="' + page + '"] > svg').css('fill', 'var(--v1)')
                            $('[page="' + page + '"]').css('border-color', 'var(--c7)')
                        }
                    })
                })
                data.on("value", snapshot => {

                    if (typeof snapshot.val().avatar == "undefined") {

                    } else {
                        userdata($('[mainava]'), 'avatar', currentUser)
                        userdata($('[mainava]'), 'attr-userid', currentUser)
                            // $('[mainava]').css('background-image', 'url(' + snapshot.val().avatar + ')').attr('userid', user.uid)
                    }

                    if (typeof snapshot.val().displayName == "undefined") {
                        async function myFunction() {
                            const {
                                value: text
                            } = await Swal.fire({
                                title: 'Input DisplayName address',
                                input: 'text',
                                inputLabel: 'Your DisplayName address',
                                inputPlaceholder: 'Enter your DisplayName address'
                            })

                            if (text) {
                                data.update({
                                    displayName: text,
                                });
                            }
                        }
                        myFunction()
                    } else {

                    }
                })
                $('.m3').css('display', 'none')
                $(document).on('click', '[set-avatar]', function() {
                    const href = $(this).attr('href')
                    if (href) {
                        data.update({
                            avatar: href,
                        });
                    }
                })
                $(document).on('click', '[set-banner]', function() {
                        const href = $(this).attr('href')
                        if (href) {
                            data.update({
                                banner: href,
                            });
                        }
                    })
                    //

                $('[loginx]').remove()
            } else {
                // User is signed out.
                console.log('No')
                setTimeout(
                    function name(params) {
                        $('.m3').css('display', 'flex')

                        $('body').prepend(a('div', 'fw ff aa fbg loginx', '31')
                            .css('background', 'var(--r5)')
                            .css('z-index', '11')
                            .css('justify-content', 'flex-end')
                            .prepend(
                                a('formx', 'ff', '311').prepend(
                                    `<input type="email" ff fw  name="" placeholder="Email" autocomplete="email" id="loginemail">
        <input  type="password" ff fw  name="" placeholder="Password" autocomplete="new-password" id="loginpassword">
        <button loginbtn style="background-color:var(--c7);" type="submit">Login</button>
        <button registerbtn style="background-color:rgb(88, 101, 242);" type="submit">Register</button>`
                                )
                            ))
                    }, 1000)
            }
        });

        $('body').prepend(

                ///notifications
                $('body').prepend(
                    a('div', 'fw fff aa pagex page="home"', 'n8').prepend(

                    ).css('display', 'none')
                    .css('margin-bottom', '50px'),
                    a('div', 'fw fff aa pagex page="add"', 'n7').css('display', 'none').prepend(
                        a('form', 'ff fww', 'n71').prepend(
                            a('div', 'fww ff fbg id="uploadPostFile"', 'n711').html(
                                `
<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24"><g><rect fill="none" height="24" width="24"/></g><g><path d="M7.4,10h1.59v5c0,0.55,0.45,1,1,1h4c0.55,0,1-0.45,1-1v-5h1.59c0.89,0,1.34-1.08,0.71-1.71L12.7,3.7 c-0.39-0.39-1.02-0.39-1.41,0L6.7,8.29C6.07,8.92,6.51,10,7.4,10z M5,19c0,0.55,0.45,1,1,1h12c0.55,0,1-0.45,1-1s-0.45-1-1-1H6 C5.45,18,5,18.45,5,19z"/></g></svg>`
                            ).ready(
                                function name(params) {
                                    sh('.mn711')
                                }
                            )
                            .css('background-color', 'var(--c7)').css('border-radius', '10px'),
                            input('uploadPostTitle', 'ff fww name="title"', 'text', 'title', 'Title')
                            .css('height', '1.4rem').html(''),
                            `<select fww ff id="uploadPostType" name="type">
  <option value="post">Type: Post</option>
  
</select>`,
                            input('uploadPostSubmit', 'ff value="Post" fww', 'submit', '', '')
                            .css('height', '1.4rem').html(''),

                        ),
                    ).css('margin-bottom', '50px')
                    .css('padding', '1rem')
                    .css('gap', '1rem'),
                    a('div', 'fw fff aa pagex page="notifications"', 'n6').css('display', 'none').prepend(

                        a('div', ' fff', 'n62').prepend(
                            'Notifications'
                        ).css('font-size', '1.5rem'),
                        a('div', 'fw fff', 'n61').prepend(
                            ''
                        )

                    ).css('margin-bottom', '50px')
                    .css('padding', '1rem')
                    .css('gap', '1rem'),

                    a('div', 'fw ff aa pagex page="account"', 'n4').prepend(

                    ).css('display', 'none')
                    .css('margin-bottom', '50px'),
                    a('div', 'fw ff aa pagex page="search"', 'n3').css('display', 'none').prepend(
                        a('div', 'fw fff', 'n31').prepend(
                            input('searchbox', 'ff fw', 'text', 'search', 'Search Users...').html(''),
                            a('div', 'fw fff search-results', 'n32').prepend( // The div where the data of search put showed!


                            ),
                        )
                        .css('padding', '1.5rem').css('gap', '1rem')
                    )
                    .css('margin-bottom', '50px'),
                    ///Bottom Menu Bar///
                    a('div', 'fw ff', '2').prepend(
                        ''
                    )
                    .css('position', 'fixed')
                    .css('bottom', '0')
                    .css('left', '0')
                    .css('height', '30px')
                    .css('padding', '10px 20px')
                    .css('background', 'var(--r5)')
                    .css('flex-direction', 'row')
                    .css('justify-content', 'space-between')
                    .css('z-index', '10').ready(
                        function name(params) {
                            $('body').css('margin-bottom', '75px')
                            const data = [{
                                img: '',
                                name: 'view-page page="home"',
                                color: '',
                                element: icon_heart,
                                br: '',
                            }, {
                                img: 'https://cdn.discordapp.com/attachments/399102162459688960/870645884076052530/Search_f1f1aa5058bd080628dda43c042a9aba.png',
                                name: 'view-page page="search"',
                                color: '',
                                element: '',
                                br: '',
                            }, {
                                img: '',
                                name: 'view-page page="add"',
                                color: '',
                                element: icon_add,
                                br: '',
                            }, {
                                img: '',
                                name: 'view-page page="notifications"',
                                color: '',
                                element: icon_notification,
                                br: '',
                            }, {
                                img: '',
                                element: '',
                                name: 'view-page page="account" mainava get-user',
                                color: 'rgb(88, 101, 242)',
                                br: '100rem',
                            }];
                            $.each(data, function(v, o) {
                                const data = a('div', 'fw fbg ff ' + o.name + '', '21')
                                    .prepend(
                                        o.element
                                    )
                                    .css('background-color', o.color)
                                    .css('border-radius', o.br)
                                    .css('width', '30px')
                                    .css('background-image', 'url(' + o.img + ')')
                                $('.m2').append(data)
                            })
                        }
                    ),
                    ///Bottom Menu Bar///

                )
            )
            .css('background-color', 'var(--r7)')
    </script>
</body>

</html>