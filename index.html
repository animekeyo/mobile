<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="/mobile-manifest.json?clear-2553">
    <link rel="icon" href="/icon-192x192.png">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('service worker registered'))
                .catch(err => console.log('service worker not registered', err));
        }
    </script>
    <title>Anime Keyo</title>
    <script src="https://canary.animekeyo.com/scripts/jquery.js"></script>
    <!---//////////////////////////------jquery------///////////////////////////--->

    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-messaging.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.7/dist/sweetalert2.all.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

    <script src="https://canary.animekeyo.com/scripts/firebase.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
        var SUPABASE_URL = 'https://srdaietqaprjhpuwovbv.supabase.co';
        var SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYyNDgwOTQxMiwiZXhwIjoxOTQwMzg1NDEyfQ.yBwqUvBsIY3pbITcKgZ99jlEnVfDOhJDOQ6-hHKdaqY';

        var supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY)
    </script>
    <script>
        function a(inn, id, clas) {
            if (inn, id) {
                aa = $(`<${inn}   ${id} class="m${clas}"></${inn}>`);
            } else if (inn) {
                aa = $(`<${inn}></${inn}>`);
            }
            return aa
        };

        function input(id, classx, type, auto, placeholder) {

            aa = $(` <input  type="${type}" ${classx}  placeholder="${placeholder}" autocomplete="${auto}" id="${id}">`);
            return aa
        };

        function srcx(inn, id, clas, src) {
            if (inn, id) {
                aa = $(`<${inn}  ${id} src="${src}" class="m${clas}">`);
            }
            return aa
        };

        function sh(dsfvf) {
            $(dsfvf).css({
                'height': $(dsfvf).width() + 'px'
            })
            $(window).on('resize', function() {
                $(dsfvf).css({
                    'height': $(dsfvf).width() + 'px'
                })
            })
        }

        function sw(dsfvf) {
            $(dsfvf).css({
                'width': $(dsfvf).height() + 'px'
            })
            $(window).on('resize', function() {
                $(dsfvf).css({
                    'width': $(dsfvf).height() + 'px'
                })
            })
        }
    </script>
    <style ux>
@import url("https://canary.animekeyo.com/styles/style.css?clear1-5");
    </style>
    <style mi>
        :root{
            --v1:rgb(88, 101, 242);
        }
        .m1 {
            display: grid;
            grid-gap: 10px;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        }
        
        input {
            padding: 0.7rem 1rem;
            height: 2.5rem;
            background: var(--r10);
            color: white;
            font-size: 1.2rem;
            border-radius: 5px;
            font-family: 'C1';
        }
        
input:focus {
    box-shadow: 0px 0px 0px 3px var(--c7);
}
        input::placeholder {
    color: white;
    
    letter-spacing: 1px;
}


        formx {
            padding: 1.3rem 1rem;
            gap: 0.5rem;
            align-items: flex-start!important;
            width: -webkit-fill-available;
        }
        
        .m1x1 {
            padding: 1rem;
            color: var(--c76);
            background: var(--r15);
            border-radius: 5px;
        }
        
        .m1x {
            margin: 10px;
            gap: 10px;
        }
        
        button {
            padding: 1rem 1.2rem;
            background: var(--r10);
            color: white;
            font-size: 1.1rem;
            border-radius: 5px;
            border: none;
            font-family: 'C1';
            width: -webkit-fill-available;
        }
        
        .m5211 {
            height: 40px;
            border-radius: 100rem;
            width: 40px;
        }
        
        .m521 {
            display: flex;
            flex-direction: row;
            justify-content: flex-start;
            padding: 1rem;
            /* margin: 10px; f*/
            gap: 15px;
            border-radius: 10px;
            background: var(--r15);
        }
        
        .m52 {
            margin: 1rem;
            gap: 0.5rem;
        }
        [fff] {
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    flex-direction: column;
    flex-wrap: nowrap;
    align-content: center;
    justify-content: flex-start;
    align-items: flex-start;
}
.mn32 {
    gap: 0.6rem;
}
.mn321 {
    height: 2.5rem;
    flex-direction: row;
    justify-content: flex-start;
    align-items: center;
    gap: 0.5rem;
    padding-bottom: 10px;
    border-bottom: 2px solid var(--r15);
}
.mn3211 {
    height: 40px;
    width: 40px;
    background-color: white;
    border-radius: 100rem;
}
.mn3212 {
    max-width: max-content;
}
.mn4121 {
    height: 58px;
    width: 58px;
    border: 7px solid var(--r5);
    margin: 4px;
    background-color: var( --v1);
    border-radius: 100rem;
}
.mn412 {
    padding: 1rem;
    display: flex;
    flex-direction: row;
    align-items: center;
    background: var(--r5);
}
.mn4122x {
    width: fit-content;
    height: fit-content;
    padding: 0.5rem 1rem;
    background-color: var(--v1);
    border-radius: 5px;
}
.mn4121x {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 01rem;
}
.mn41221 svg {
    fill: white;
    height: 22px;
    width: 22px;
}
.mn41221 {
    font-size: 1.3rem;
    display: flex;
    flex-direction: row;
    gap: 5px;
}
.mn412221 {
    text-transform: uppercase;
    font-size: 0.75rem;
    color: hsl(0deg 0% 70%);
}
.mn4122 {
    gap: 0.3rem;
}
.mn41222 {
    gap: 0.1rem;
}
.mn412221.n23xdi {
    font-size: 0.9rem;
    color: white;
}
.mn4122x svg {
    fill: white;
    width: 1.5rem;
    height: 1.5rem;
}
.m21[mainava] {
    width: 24px!important;
    height: 24px!important;
    border: 3px solid white;
}
sd {
    color: var(--v1);
}
    </style>
</head>

<body>


    <script>
        const messaging = firebase.messaging();

        messaging.getToken({
            vapidKey: 'BO_pr8rrSONw5247EO9yl9dfUfz635UjfXd6fb-wiExxOwzorFJag7BbkqQLiBtqvkM3Zcln2bvppZLUCmODLFI'
        }).then((currentToken) => {
            if (currentToken) {
                // Send the token to your server and update the UI if necessary
                // ...
                console.log(currentToken)
            } else {
                // Show permission request UI
                console.log('No registration token available. Request permission to generate one.');
                // ...
            }
        }).catch((err) => {
            console.log('An error occurred while retrieving token. ', err);
            // ...
        });
        messaging.onMessage((payload) => {
            console.log('Message received. ', payload);
            // ...
        });

        // sh('class')
        // a('div','id','class')
        // srcx('img','id','class','src') 
        // .css('','')
        $(document).on('click', '[registerbtn]', function name(params) {
            const email = $('#loginemail').val();
            const password = $('#loginpassword').val();
            if (email) {
                if (password) {
                    firebase.auth().createUserWithEmailAndPassword(email, password)
                        .then((userCredential) => {
                            // Signed in 
                            var user = userCredential.user;
                            // ...
                        })
                        .catch((error) => {
                            var errorCode = error.code;
                            var errorMessage = error.message;
                            swal('', errorMessage)
                        });
                }
            }

        })
        $(document).on('click', '[loginbtn]', function name(params) {
            const email = $('#loginemail').val();
            const password = $('#loginpassword').val();
            if (email) {
                if (password) {
                    firebase.auth().signInWithEmailAndPassword(email, password)
                        .then((userCredential) => {
                            // Signed in 
                            var user = userCredential.user;
                            // ...
                        })
                        .catch((error) => {
                            var errorCode = error.code;
                            var errorMessage = error.message;
                            swal('', errorMessage)
                                // ..
                        });
                }
            }

        })

        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                const currentUser = user.uid;
$(document).on('click','[ruf]',function(){
const ruser = $(this).attr('userid');
const rtype = $(this).attr('rtype');
if(rtype == 'follow'){
    follow(ruser)
}
});
                function follow(FollowUser){
                    const MainYou = firebase.database().ref('/users/'+ currentUser +'/following/'+ FollowUser);
                    const DataThey = firebase.database().ref('/users/'+ FollowUser +'/followers/'+ currentUser);
                    MainYou.once("value", function(snapshot) {
                        if (snapshot.exists()){
                            MainYou.remove()
                            DataThey.remove()
                        } else {
                            DataThey.update({
                                follow: true,
                            })
                            MainYou.update({
                                follow: true,
                            })
                        }
                    })
                }
                function checkfollow(FollowUser,DEX){
                    const MainYou = firebase.database().ref('/users/'+ currentUser +'/following/'+ FollowUser);
                    MainYou.on("value", function(snapshot) {
                        if (snapshot.exists()){
                            DEX.html(`
<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24"><g><rect fill="none" height="24" width="24"/><rect fill="none" height="24" width="24"/></g><g><path d="M14,8c0-2.21-1.79-4-4-4S6,5.79,6,8s1.79,4,4,4S14,10.21,14,8z M2,18v1c0,0.55,0.45,1,1,1h14c0.55,0,1-0.45,1-1v-1 c0-2.66-5.33-4-8-4S2,15.34,2,18z M18,10h4c0.55,0,1,0.45,1,1v0c0,0.55-0.45,1-1,1h-4c-0.55,0-1-0.45-1-1v0 C17,10.45,17.45,10,18,10z"/></g></svg>`
).css('background','var(--c19)') 
                        } else {
                            DEX.html(`
<svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V8c0-.55-.45-1-1-1s-1 .45-1 1v2H2c-.55 0-1 .45-1 1s.45 1 1 1h2v2c0 .55.45 1 1 1s1-.45 1-1v-2h2c.55 0 1-.45 1-1s-.45-1-1-1H6zm9 4c-2.67 0-8 1.34-8 4v1c0 .55.45 1 1 1h14c.55 0 1-.45 1-1v-1c0-2.66-5.33-4-8-4z"/></svg>`
                        ).css('background','var(--v1)')
                            
                        }
                    })
                }
                function userdata(div,type,useridxz){
                    if (useridxz && type && div) {
                        const data = firebase.database().ref('/users/' + useridxz);
                        data.on("value", snapshot => {
                       if(type == 'displayName'){
                            div.text(snapshot.val().displayName)
                        } else if(type == 'avatar'){
                            div.css('background-image','url('+snapshot.val().avatar+')')
                        } else if(type == 'banner'){
                            div.css('background-image','url('+snapshot.val().banner+')')
                        } else if(type == 'userid'){
                            div.text(snapshot.val().userid)
                        } else if(type == 'attr-userid'){
                            div.attr('userid',snapshot.val().userid)
                        } else if(type == 'followers-count'){
                            data.child('followers').on("value", snapshot => {
                                div.text(snapshot.numChildren())
                            })
                            
                        } else if(type == 'State'){
                            if(snapshot.val().State == true){
    div.css('box-shadow','0px 0px 0px 4px var(--c7)')
} else if (snapshot.val().State == false) {
    div.css('box-shadow','0px 0px 0px 4px var(--c19)')
} else {
    div.css('box-shadow','0px 0px 0px 4px var(--c19)')
}
                        } else if(type == 'following-count'){
                            data.child('following').on("value", snapshot => {
                                div.text(snapshot.numChildren())
                           })
                        } else if(type == 'verified'){
                            data.child('badges').on("value", snapshot => {
                                if(snapshot.exists()){
                                    if(snapshot.val().verified){
                                    div.append(`
<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24"><g><rect fill="none" height="24" width="24"/><rect fill="none" height="24" width="24"/></g><g><path d="M23,12l-2.44-2.79l0.34-3.69l-3.61-0.82L15.4,1.5L12,2.96L8.6,1.5L6.71,4.69L3.1,5.5L3.44,9.2L1,12l2.44,2.79l-0.34,3.7 l3.61,0.82L8.6,22.5l3.4-1.47l3.4,1.46l1.89-3.19l3.61-0.82l-0.34-3.69L23,12z M9.38,16.01L7,13.61c-0.39-0.39-0.39-1.02,0-1.41 l0.07-0.07c0.39-0.39,1.03-0.39,1.42,0l1.61,1.62l5.15-5.16c0.39-0.39,1.03-0.39,1.42,0l0.07,0.07c0.39,0.39,0.39,1.02,0,1.41 l-5.92,5.94C10.41,16.4,9.78,16.4,9.38,16.01z"/></g></svg>`)
                                } else {

                                }
                                }
                                
                           })
                        } else {
                            console.log('Error [userdata]2')
                        }
                        })
                        
                    } else {
                        console.log('Error [userdata]1')
                    }
                }
                /////////////////////////////
                $(document).on('click','[get-user]',function(){
                    const userid = $(this).attr('userid')
                    if(userid){
                        
                        const datac =  a('div','fw fff','n41').prepend(
                        a('div','fw fff fbg','n411').prepend( /// Profile Banner
                   
                        ).css({
                            'height':' 130px',
                            'background-color': 'var(--v1)',
                        }),
                        a('div','fw fff','n412').prepend( /// Profile Meta
                        
                        a('div','fw fff','n4121x').prepend( /// Profile Meta
                        a('div','fw fff fbg','n4121').prepend( /// Profile PIC
                   
                        ),
                        a('div',' fff','n4122').prepend( /// Profile Meta
                        a('div',' ','n41221').text(''),
                        a('div',' fff','n41222').prepend( /// Profile 
                        a('div',' ','n412221 n23xdi').prepend( /// Profile 
                       'Followers <sd Followers-Count>1</sd>' ),
                        a('div',' ','n412221').prepend( /// Profile 
                       'Following <sd Following-Count>1</sd>' )
                        )
                        )
                        ),
                        
                        )
                    );
                   $('.mn4').html(datac)
                   userdata($('.mn41221'),'displayName',userid)
                   userdata($('.mn41221'),'verified',userid)
                   
                   userdata($('.mn4121'),'avatar',userid)
                   userdata($('.mn4121'),'State',userid)
                   userdata($('.mn411'),'banner',userid)
                   userdata($('[Following-Count]'),'following-count',userid)
                   userdata($('[Followers-Count]'),'followers-count',userid)
                   if(currentUser == userid){
                    $('.mn412').append(a('div','fw fff','n4122x').html( /// Profile Follow
                   `
<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24"><rect fill="none" height="24" width="24"/><path d="M19.5,12c0-0.23-0.01-0.45-0.03-0.68l1.86-1.41c0.4-0.3,0.51-0.86,0.26-1.3l-1.87-3.23c-0.25-0.44-0.79-0.62-1.25-0.42 l-2.15,0.91c-0.37-0.26-0.76-0.49-1.17-0.68l-0.29-2.31C14.8,2.38,14.37,2,13.87,2h-3.73C9.63,2,9.2,2.38,9.14,2.88L8.85,5.19 c-0.41,0.19-0.8,0.42-1.17,0.68L5.53,4.96c-0.46-0.2-1-0.02-1.25,0.42L2.41,8.62c-0.25,0.44-0.14,0.99,0.26,1.3l1.86,1.41 C4.51,11.55,4.5,11.77,4.5,12s0.01,0.45,0.03,0.68l-1.86,1.41c-0.4,0.3-0.51,0.86-0.26,1.3l1.87,3.23c0.25,0.44,0.79,0.62,1.25,0.42 l2.15-0.91c0.37,0.26,0.76,0.49,1.17,0.68l0.29,2.31C9.2,21.62,9.63,22,10.13,22h3.73c0.5,0,0.93-0.38,0.99-0.88l0.29-2.31 c0.41-0.19,0.8-0.42,1.17-0.68l2.15,0.91c0.46,0.2,1,0.02,1.25-0.42l1.87-3.23c0.25-0.44,0.14-0.99-0.26-1.3l-1.86-1.41 C19.49,12.45,19.5,12.23,19.5,12z M12.04,15.5c-1.93,0-3.5-1.57-3.5-3.5s1.57-3.5,3.5-3.5s3.5,1.57,3.5,3.5S13.97,15.5,12.04,15.5z"/></svg>`
                        ))
                   } else {
                    $('.mn412').append(a('div','fw fff ruf rtype="follow" userid="'+userid+'"','n4122x')
                    .html('')).ready(function(){
                        checkfollow(userid,$('[ruf][rtype="follow"][userid="'+userid+'"]'))
                    });
                   }
                   $('body > div[pagex]').hide()
                        $('[page="account"]').show()
                    }
                    
                }
                )
                // User is signed in./////
                console.log(user.uid)


                const data = firebase.database().ref('/users/' + user.uid);
                data.update({
                    State: true,
                });
                data.onDisconnect().update({
                    State: false,
                });
                $(document).on('input', '#searchbox', function() {
                    const val = $(this).val();
                   
                        firebase.database().ref('/users').orderByChild('displayName').startAt(val).once("value", function(snapshot) {
                            $('[search-results]').html('')
                            snapshot.forEach(function(data) {
                            console.log();
                        
                        $('[search-results]').append(
                            a('div','fw fff get-user userid="'+data.val().userid+'"','n321').prepend( // Main div for name and avatar
                            a('div','fw fff fbg','n3211').css('background-image','url('+data.val().avatar+')').html(''), // Avatar
                            a('div','fw fff','n3212').text(data.val().displayName) // Display Name
                        )
                        );
                        });
                    });
                    
                    
                })

                data.once("value", snapshot => {
                    if (snapshot.val().page) {
                        $(document).ready(function() {
                            $('[view-page][page="' + snapshot.val().page + '"]').trigger("click");
                        });
                    }
                    $(document).on('click', '[view-page]', function() {
                        const page = $(this).attr('page');

                        if (page) {
                            data.update({
                                page: page,
                            });
                            $('body > div[pagex]').hide()
                            $('[page="' + page + '"]').show()
                        }
                    })
                })
                data.on("value", snapshot => {

                    if (typeof snapshot.val().userid == "undefined") {
                        data.update({
                            userid: user.uid,
                        });
                    }
                    if (typeof snapshot.val().avatar == "undefined") {

                    } else {
userdata($('[mainava]'),'avatar',currentUser)
userdata($('[mainava]'),'attr-userid',currentUser)
                       // $('[mainava]').css('background-image', 'url(' + snapshot.val().avatar + ')').attr('userid', user.uid)
                    }

                    if (typeof snapshot.val().displayName == "undefined") {
                        async function myFunction() {
                            const {
                                value: text
                            } = await Swal.fire({
                                title: 'Input DisplayName address',
                                input: 'text',
                                inputLabel: 'Your DisplayName address',
                                inputPlaceholder: 'Enter your DisplayName address'
                            })

                            if (text) {
                                data.update({
                                    displayName: text,
                                });
                            }
                        }
                        myFunction()
                    } else {

                    }
                })
                $('.m3').css('display', 'none')
                $(document).on('click', '[set-avatar]', function() {
                    const href = $(this).attr('href')
                    if (href) {
                        data.update({
                            avatar: href,
                        });
                    }
                })
                $(document).on('click', '[set-banner]', function() {
                        const href = $(this).attr('href')
                        if (href) {
                            data.update({
                                banner: href,
                            });
                        }
                    })
                    //


            } else {
                // User is signed out.
                console.log('No')
                setTimeout(
                    function name(params) {
                        $('.m3').css('display', 'flex')

                        $('.m3').prepend(a('div', 'fw ff aa fbg', '31')
                            .css('background', 'var(--r5)')
                            .css('justify-content', 'flex-end')
                            .prepend(
                                a('formx', 'ff', '311').prepend(
                                    `<input type="email" ff fw  name="" autocomplete="email" id="loginemail">
        <input  type="password" ff fw  name="" autocomplete="new-password" id="loginpassword">
        <button loginbtn style="background-color:var(--c7);" type="submit">Login</button>
        <button registerbtn style="background-color:rgb(88, 101, 242);" type="submit">Register</button>`
                                )
                            ))
                    }, 1000)
            }
        });

        $('body').prepend(


                $('body').prepend(
                    
                a('div','fw ff aa pagex page="account"','n4').prepend(
                    
                )
                .css('margin-bottom','50px'),
                a('div','fw ff aa pagex page="search"','n3').prepend(
                    a('div','fw fff','n31').prepend(
                    input('searchbox','ff fw','text','search','Search Users...').html(''),
                    a('div','fw fff search-results','n32').prepend( // The div where the data of search put showed!

                      
                    ),
                    )
                    .css('padding','1.5rem').css('gap','1rem')
                )
                .css('margin-bottom','50px'),
                ///Bottom Menu Bar///
                a('div', 'fw ff', '2').prepend(
                    ''
                )
                .css('position', 'fixed')
                .css('bottom', '0')
                .css('left', '0')
                .css('height', '30px')
                .css('padding', '10px 20px')
                .css('background', 'var(--r5)')
                .css('flex-direction', 'row')
                .css('justify-content', 'space-between')
                .css('z-index', '10').ready(
                    function name(params) {
                        $('body').css('margin-bottom', '75px')
                        const data = [{
                            img: 'https://cdn.discordapp.com/attachments/399102162459688960/870645564621062184/EmojiSymbolsCategory_2acc53c1a6b1d999f2a5ca4c059d9d12_1.png',
                            name: 'view-page page="home"',
                            color: '',
                            br: '',
                        }, {
                            img: 'https://cdn.discordapp.com/attachments/399102162459688960/870645884076052530/Search_f1f1aa5058bd080628dda43c042a9aba.png',
                            name: 'view-page page="search"',
                            color: '',
                            br: '',
                        }, {
                            img: 'https://cdn.discordapp.com/attachments/399102162459688960/870645552629551164/PlusCircle_31499eef2b3ba2b92003ae6d0ec838a1.png',
                            name: 'view-page page="add"',
                            color: '',
                            br: '',
                        }, {
                            img: 'https://cdn.discordapp.com/attachments/399102162459688960/870645575891173446/Bell_3d990f6114a0fd6f02165f5c7a05c77f.png',
                            name: 'view-page page="notfi"',
                            color: '',
                            br: '',
                        }, {
                            img: '',
                            name: 'view-page page="account" mainava get-user',
                            color: 'rgb(88, 101, 242)',
                            br: '100rem',
                        }];
                        $.each(data, function(v, o) {
                            const data = a('div', 'fw fbg ff ' + o.name + '', '21')
                                .prepend(
                                    ''
                                )
                                .css('background-color', o.color)
                                .css('border-radius', o.br)
                                .css('width', '30px')
                                .css('background-image', 'url(' + o.img + ')')
                            $('.m2').append(data)
                        })
                    }
                ),
                ///Bottom Menu Bar///

            )
        )
            .css('background-color', 'var(--r7)')
    </script>
</body>

</html>